<!DOCTYPE html>
<html lang="en">
	<head>
		<link href="style.css" rel="stylesheet" />
		<link href="animations.css" rel="stylesheet" />
		<meta charset="utf-8" />
		<title>Fun with Network Graphs</title>
		<meta name="author" content="" />
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			href="https://fonts.googleapis.com/css2?family=Work+Sans&family=Roboto+Mono&family=Roboto+Slab&display=swap"
			rel="stylesheet"
		/>
	</head>

	<body>
		<header class="heading">
			<div class="heading--title-wrapper">
				<div class="heading--title-circle">
					<h1>
						<a href="index.html">
							<span class="cloud-underline">PETE</span><br /><span
								class="cloud-underline"
								>FAULCONBRIDGE</span
							></a
						>
					</h1>
				</div>
				<div class="heading--controls">
					<!-- icons from heroicons.dev -->
					<button
						id="nightmode-button"
						class="heading--controls--button"
						aria-labelledby="nightmode-label"
					>
						<svg
							class="heading--controls--button--icon moon-icon"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 20 20"
							fill="currentColor"
						>
							<path
								d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
							/>
						</svg>
						<svg
							class="heading--controls--icon sun-icon"
							fill="currentColor"
							stroke="currentColor"
							viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
							></path>
						</svg>
						<span id="nightmode-label" hidden
							>Toggle night mode/day mode</span
						>
					</button>
					<a
						class="heading--controls--button"
						aria-labelledby="email-label"
						href="index.html#contact"
					>
						<svg
							class="heading--controls--button--icon"
							xmlns="http://www.w3.org/2000/svg"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
							/>
						</svg>
						<span id="email-label" hidden
							>View contact information</span
						>
					</a>
					<button
						class="heading--controls--button"
						aria-labelledby="github-label"
					>
						<a
							href="https://github.com/bryophyta/"
							target="_blank"
							rel="noopener"
						>
							<svg
								class="heading--controls--button--icon"
								viewBox="-1 -1 26 26"
								stroke="currentColor"
								fill="currentColor"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"
								/>
							</svg>
						</a>
						<span id="github-label" hidden
							>View my Github (opens in external window).</span
						>
					</button>
				</div>
			</div>
			<div class="heading--sun"></div>
			<div class="heading--moon heading--moon__set"></div>
			<svg
				class="heading--wave"
				preserveAspectRatio="none"
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 52.917 9.26"
			>
				<path
					id="horizon"
					d="M0 9.26V2.646C3.271 6.67 11.311 1.01 15.314 5.385c3.504 3.83 12.92-1.446 18.832-1.103 6.562.38 14.353-2.71 18.77-.7V9.26z"
					fill="currentColor"
				/>
			</svg>
		</header>
		<main>
			
			<div>
				<a href="index.html" class="no-text-decoration"
					><span class="heading--back-link"
						><svg
							style="width: 1rem; height: 1rem"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M15 19l-7-7 7-7"
							></path>
						</svg>
						back to homepage</span
					></a
				>
			</div>
			<h1 class="project-title">
				Fun with Network Graphs
			</h1>
			 <h2 id="project-background">Project Background</h2>

<p>A little while ago I started reading about some of the surprising ways in which the structures of relationships between people can affect the way that information spreads in a population. (One quick, counterintuitive result is the ‘friendship paradox’ – most people have fewer friends than their friends do, on average!)</p>

<p>To understand this stuff better, I wanted to read a bit more about network science, so I’ve been making my way through Albert-László Barabási’s textbook on Network Science, and I decided to write some code as I went along to test my understanding of the concepts I was reading about. For example, I wanted to be able to generate random networks, and analyse their key properties. This then led me to try and work out ways of drawing and re-arranging the networks I was creating, and the project grew from there.</p>

<p>There are various JavaScript libraries out there for drawing network graphs (I had a bit of a play with sigmajs, for example) but I wanted to try writing my own, both as a coding challenge and as a way of helping me understand the underlying network science.</p>

<div>
<img class="image-full" src="images/graph-screenshots.png" alt="One of my network graph pages displayed on a tablet and a phone." />
</div>

<h2 id="outputs">Outputs</h2>

<p>I’m still having fun seeing what I can do with this, but so far I’ve made the following:</p>

<ul>
  <li>A page <a href="projects/f-r-demo/index.html" target="_blank" rel="noopener">explaining the basics of the Fruchterman-Reingold algorithm</a>.</li>
  <li>A page which <a href="projects/influence-graph/enemies.html" target="_blank" rel="noopener">reconstructs and analyses networks from WikiData</a> (this does load on mobile, but I’m still working on a fully responsive version).</li>
  <li>The <a href="https://github.com/bryophyta/Network-graphs-with-SVG" target="_blank" rel="noopener">underlying TypeScript class definition</a>.</li>
</ul>

<h2 id="project-description">Project Description</h2>

<p>Once I had the key functionality in place, I decided to refactor the project to bundle all of the key features into a single class, and transferred it from vanilla JavaScript to TypeScript. My main reason for doing this was to be able to easily instantiate multiple graphs on the same page. As a demonstration of this ability, you can check out a <a href="projects/f-r-demo/index.html" target="_blank" rel="noopener">mini explainer page</a> that I made to illustrate the principles behind the Fruchterman-Reingold algorithm for placing nodes on a graph.</p>

<p>The result is a utility which can generate, analyse, draw and re-arrange network graphs. You just need to pass it an <code class="highlighter-rouge">&lt;svg&gt;</code> element, create a new graph instance, and then easily perform the following with simple class methods:</p>

<ul>
  <li>Add and remove nodes and edges.</li>
  <li>Generate random graphs with N nodes and probability p of any two nodes being connected.</li>
  <li>Draw the graph on the SVG.</li>
  <li>Rearrange the graph randomly, in a circle, or using the Fruchterman-Reingold algorithm (this one aims to make the graph more easily interpretable by humans).</li>
  <li>Calculate the degree of connectedness of a node, or of the graph as a whole.</li>
  <li>Perform algorithms like breadth-first-search to:
    <ul>
      <li>Find the shortest path between two nodes.</li>
      <li>Map ‘connected components’ in a set of graph data.</li>
      <li>Isolate the ‘largest connected component’ in a set of data.</li>
    </ul>
  </li>
</ul>

<h2 id="process-and-challenges">Process and Challenges</h2>

<p>The project started out very modest: just writing a couple of functions to create and analyse small random graphs.</p>

<p>Because of this, I didn’t worry too much initially about my data structures.</p>

<p>This meant that, at one point, I was looping through all of the nodes in the network each time I wanted to find out which nodes a given other node was connected to. In and of itself this works fine for small or even reasonably large datasets. However, when it’s being called within functions which already involve embedded loops through all the nodes (e.g. the Fruchterman-Reingold algorithm), this data structure meant adding yet <em>another</em> loop through the network embedded in each pass! This <em>would</em> start to cause trouble with larger datasets.</p>

<p>So I softened the more functional approach that I’d been working with up until then. I added more, and flatter, persistent data structures, which allowed for much less looping. Trying to negotiate the right balance, and to think about how to make sure that the various arrays and dictionaries would remain in sync, was a very useful exercise, though!</p>

<p>The more general lesson is, I suppose, one I already knew: planning your data architecture in advance can make things much easier in the long run! But it’s always helpful to have a reminder.</p>

<h2 id="biggest-facepalm-lesson-learned">Biggest #facepalm Lesson Learned</h2>

<p>I spent longer than I’d care to admit pouring through the docs on mouse events for SVG elements, trying to work out why my mouseover callback function was being continuously called (and hence triggering a costly re-draw of the whole graph), even when I wasn’t moving the mouse. Eventually it dawned on my that it was precisely <em>because</em> the graph was being re-drawn that the event kept being triggered, as this meant that a <em>new</em> element kept being drawn right underneath the cursor! I should probably have seen this one coming, but it’s definitely a lesson I won’t forget any time soon!</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Friendship_paradox" target="_blank" rel="noopener">The Friendship Paradox on Wikipedia.</a></li>
  <li><em>Network Science</em> by Albert-László Barabási (available for free on <a href="http://networksciencebook.com/" target="_blank" rel="noopener">http://networksciencebook.com/</a>).</li>
  <li><a href="http://sigmajs.org/" target="_blank" rel="noopener">sigmajs</a></li>
</ul>

		</main>
		<footer class="footer"></footer>
	</body>
</html>

<script>
	const nightmodeButton = document.querySelector("#nightmode-button");
	const body = document.querySelector("body");
	const wrapper = document.querySelector(".page-wrapper");
	const heading = document.querySelector(".heading");
	const footer = document.querySelector(".footer");
	const controls = document.querySelector(".heading--controls");
	const wave = document.querySelector(".heading--wave");
	const sun = document.querySelector(".heading--sun");
	const moon = document.querySelector(".heading--moon");
	nightmodeButton.addEventListener("click", toggleSky);

	const themeMode = localStorage.getItem("theme");
	if (themeMode === "dark") {
		body.classList.add("body__nighttime");
	}

	const pulseLabels = document.querySelectorAll(".js-pulse");
	const pulseLabelsDictionary = {};
	for (let label of pulseLabels) {
		const labelType = label.dataset.type;
		if (Object.keys(pulseLabelsDictionary).includes(labelType)) {
			pulseLabelsDictionary[labelType].push(label);
		} else {
			pulseLabelsDictionary[labelType] = [label];
		}
	}

	window.addEventListener("load", function () {
		body.classList.add("body-transition");
		heading.classList.add("transition-2");
		footer.classList.add("transition-2");
		controls.classList.add("transition-2");
		wave.classList.add("transition-2");
		sun.classList.add("transition-3");
		moon.classList.add("transition-3");
	});

	function toggleSky() {
		body.classList.toggle("body__nighttime");
		sun.classList.toggle("heading--sun__set");
		moon.classList.toggle("heading--moon__set");
		let theme = "light";
		if (body.classList.contains("body__nighttime")) {
			theme = "dark";
		}
		localStorage.setItem("theme", theme);
	}

	function pulseSame(e) {
		const labelType = this.dataset.type;
		const labelsOfType = pulseLabelsDictionary[labelType];
		labelsOfType.forEach((label) => {
			label.classList.add("pulse");
			if (label !== this) {
				label.classList.add("pulse-delay-reverse");
			}
		});
	}

	function removePulse(e) {
		if (this.classList.contains("pulse")) {
			this.classList.remove("pulse");
		}
		if (this.classList.contains("pulse-delay-reverse")) {
			this.classList.remove("pulse-delay-reverse");
		}
	}

	pulseLabels.forEach((item) =>
		item.addEventListener("mouseover", pulseSame)
	);
	pulseLabels.forEach((item) =>
		item.addEventListener("animationend", removePulse)
	);
</script>
